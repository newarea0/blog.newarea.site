# å®šæ—¶å™¨

## å»¶æ—¶å™¨

ç±»ä¼¼ JS çš„ setTimeoutï¼Œåœ¨æŒ‡å®šæ—¶é—´åæ‰§è¡Œä¸€æ¬¡å›è°ƒã€‚

### Future.delayed

```dart
// é¡µé¢åŠ è½½åå»¶è¿Ÿæ‰§è¡Œ
@override
void initState() {
  super.initState();

  Future.delayed(Duration(milliseconds: 300), () {
    print('300ms åæ‰§è¡Œ');
  });
}
```

æ”¯æŒ async/awaitï¼š

```dart
await Future.delayed(Duration(milliseconds: 300));
print('300ms åæ‰§è¡Œ');
```

## å‘¨æœŸå™¨

ç±»ä¼¼ JS çš„ setIntervalï¼Œæ¯éš”æŒ‡å®šæ—¶é—´æ‰§è¡Œä¸€æ¬¡å›è°ƒã€‚

ç¤ºä¾‹ä¸€ï¼šè½®è¯¢è·å–æ•°æ®

```dart
import 'dart:async';

late Timer timer;

@override
void initState() {
  super.initState();
  // initState åªæ‰§è¡Œä¸€æ¬¡ï¼Œæ‰€ä»¥ä¸éœ€è¦å–æ¶ˆ Timer
  timer = Timer.periodic(Duration(seconds: 5), (_) {
    fetchData();
  });
}

@override
void dispose() {
  // å–æ¶ˆå®šæ—¶å™¨
  timer.cancel();
  super.dispose();
}
```

ç¤ºä¾‹äºŒï¼šå€’è®¡æ—¶æŒ‰é’®

```dart
import 'dart:async';
import 'package:flutter/material.dart';

class CountdownButton extends StatefulWidget {
  @override
  State<CountdownButton> createState() => _CountdownButtonState();
}

class _CountdownButtonState extends State<CountdownButton> {
  Timer? _timer;
  int _countdown = 10;

  void _startTimer() {
    _timer?.cancel(); // å¯èƒ½å¤šæ¬¡æ‰§è¡Œ _startTimer æ–¹æ³•ï¼Œæ‰€ä»¥éœ€è¦é¿å…é‡å¤å¯åŠ¨
    _timer = Timer.periodic(Duration(seconds: 1), (timer) {
      if (_countdown == 0) {
        timer.cancel();
      } else {
        setState(() {
          _countdown--;
        });
      }
    });
  }

  @override
  void dispose() {
    _timer?.cancel(); // é¡µé¢é”€æ¯æ—¶ä¸€å®šè¦å…³é—­Timerï¼
    super.dispose();
  }

  @override
  Widget build(BuildContext context) {
    return ElevatedButton(
      onPressed: _startTimer,
      child: Text(_countdown == 0 ? 'é‡æ–°å‘é€' : '$_countdown ç§’'),
    );
  }
}
```

### å¸¸è§æ³¨æ„äº‹é¡¹

| âš ï¸ é—®é¢˜                     | ğŸ’¡ è§£å†³æ–¹æ¡ˆ                                |
| ------------------------- | -------------------------------------- |
| **Widget é”€æ¯å Timer ä»åœ¨è¿è¡Œ** | å¿…é¡»åœ¨ `dispose()` ä¸­è°ƒç”¨ `_timer?.cancel()` |
| **å¤šæ¬¡å¯åŠ¨é‡å¤è®¡æ—¶**              | å¯åŠ¨å‰å…ˆ `_timer?.cancel()`                |
| **UI ä¸æ›´æ–°**                | åœ¨å›è°ƒä¸­ä½¿ç”¨ `setState()` æ›´æ–°ç•Œé¢               |
| **åå°ä»åœ¨è¿è¡Œ**                | å¦‚æœé¡µé¢ä¸éœ€è¦ç»§ç»­è®¡æ—¶ï¼Œåº”åœ¨ç¦»å¼€é¡µé¢æ—¶å–æ¶ˆ Timer            |

## å»¶è¿Ÿæ‰§è¡Œ + å¾ªç¯æ‰§è¡Œ

```dart
Future.delayed(Duration(seconds: 1), () {
  Timer.periodic(Duration(seconds: 2), (timer) {
    print('æ‰§è¡Œä¸€æ¬¡');
  });
});

```
